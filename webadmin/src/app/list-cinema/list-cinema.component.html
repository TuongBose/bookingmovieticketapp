<div class="container mt-4">
  <h3 class="text-center mb-4">Danh sách rạp chiếu phim</h3>

  <!-- Nút Thêm rạp -->
  <div class="text-end mb-4">
    <button class="btn btn-success" (click)="openAddCinemaModal()">Thêm rạp</button>
  </div>

  <!-- Spinner khi đang tải -->
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Đang tải...</span>
    </div>
  </div>

  <!-- Thông báo lỗi -->
  <div *ngIf="errorMessage" class="alert alert-danger text-center">
    {{ errorMessage }}
  </div>

  <!-- Dropdown chọn thành phố -->
  <div class="mb-4">
    <label for="citySelect" class="form-label">Chọn thành phố:</label>
    <select id="citySelect" class="form-select" [(ngModel)]="selectedCity" (change)="filterCinemas()">
      <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
    </select>
  </div>

  <!-- Danh sách rạp chiếu phim -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let cinema of filteredCinemas">
      <div class="card h-100 shadow-sm">
        <img [src]="getCinemaImageUrl(cinema.id, cinema.imagename)" class="card-img-top" alt="{{ cinema.name }}"
          style="width: 100%; height: 225px; object-fit: cover;" (error)="onImageError($event, cinema.id)" />
        <div class="card-body">
          <h5 class="card-title">{{ cinema.name }}</h5>
          <p class="card-text text-muted">Thành phố: {{ cinema.city }}</p>
          <p class="card-text">Địa chỉ: {{ cinema.address }}</p>
          <p class="card-text">Số điện thoại: {{ cinema.phonenumber }}</p>
          <p class="card-text">Tọa độ: {{ cinema.coordinates }}</p>
          <p class="card-text">Số phòng chiếu tối đa: {{ cinema.maxroom }}</p>
          <a href="#" class="btn btn-primary">Xem chi tiết</a>
        </div>
      </div>
    </div>
    <!-- Hiển thị thông báo nếu không có rạp -->
    <div *ngIf="!filteredCinemas.length && !isLoading && !errorMessage" class="text-center text-muted col-12">
      Hiện không có rạp chiếu phim nào.
    </div>
  </div>

  <!-- Modal để thêm rạp -->
  <ng-template #addCinemaModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Thêm rạp chiếu phim mới</h4>
      <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
      <form #addCinemaForm="ngForm" (ngSubmit)="addCinema()">
        <div class="mb-3">
          <label for="name" class="form-label">Tên rạp</label>
          <input type="text" class="form-control" id="name" name="name" [(ngModel)]="newCinema.name" required>
        </div>
        <div class="mb-3">
          <label for="city" class="form-label">Thành phố</label>
          <select class="form-select" id="city" name="city" [(ngModel)]="newCinema.city" required>
            <option *ngFor="let province of provinces" [value]="province.name">{{ province.name }}</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="coordinates" class="form-label">Tọa độ (latitude, longitude)</label>
          <input type="text" class="form-control" id="coordinates" name="coordinates" [(ngModel)]="newCinema.coordinates" required>
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">Địa chỉ</label>
          <input type="text" class="form-control" id="address" name="address" [(ngModel)]="newCinema.address" required>
        </div>
        <div class="mb-3">
          <label for="phonenumber" class="form-label">Số điện thoại</label>
          <input type="text" class="form-control" id="phonenumber" name="phonenumber" [(ngModel)]="newCinema.phonenumber" required>
        </div>
        <div class="mb-3">
          <label for="maxroom" class="form-label">Số phòng chiếu tối đa</label>
          <input type="number" class="form-control" id="maxroom" name="maxroom" [(ngModel)]="newCinema.maxroom" required>
        </div>
        <div class="mb-3">
          <label for="imagename" class="form-label">Tải lên hình ảnh</label>
          <input type="file" class="form-control" id="imagename" name="imagename" (change)="onImageSelected($event)" accept="image/*">
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="!addCinemaForm.valid">Thêm rạp</button>
        <button type="button" class="btn btn-secondary ms-2" (click)="modal.dismiss('Close click')">Hủy</button>
      </form>
    </div>
  </ng-template>
</div>